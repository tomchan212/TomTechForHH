<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>院友零用金 結欠/結餘 WhatsApp 追數</title>
  <script>(function(){try{if(localStorage.getItem('tomtech-theme')==='dark')document.documentElement.classList.add('dark');}catch(e){}})();</script>
  <link rel="stylesheet" href="money-styles.css">
</head>
<body>
  <div class="app">
    <!-- 頂部：標題 + 工具列 -->
    <header class="app-header">
      <a href="TomTech.html" class="btn-home">首頁</a>
      <h1 class="app-title">院友零用金 結欠/結餘 WhatsApp 追數</h1>
      <nav class="toolbar">
        <div class="toolbar-group">
          <button type="button" class="btn-help" id="btnHelp">說明</button>
          <button type="button" class="btn-privacy" id="btnPrivacy" title="私隱與資料存放說明">私隱說明</button>
          <button type="button" class="btn-template" id="btnTemplate">範本</button>
          <span class="import-file-name" id="importFileName"></span>
          <button type="button" class="btn-import" id="btnImport" title="從 names.txt 匯入院友名單">匯入院友名字</button>
          <input type="file" id="importFile" accept=".txt" />
          <button type="button" class="btn-clear" id="btnClear" title="清空所有記錄">清空</button>
        </div>
        <div class="toolbar-group toolbar-group-filter">
          <span class="filter-label">篩選</span>
          <div class="filter-bar">
            <button type="button" class="btn-filter active" data-filter="all">全部</button>
            <button type="button" class="btn-filter" data-filter="deficit">結欠</button>
            <button type="button" class="btn-filter" data-filter="balance">結餘</button>
          </div>
        </div>
      </nav>
    </header>

    <!-- 主內容：左表單 + 右預覽 -->
    <main class="app-main">
      <section class="section-table">
        <div class="table-wrap">
          <table>
            <colgroup>
              <col style="width: 28%" />
              <col style="width: 22%" />
              <col style="width: 28%" />
              <col style="width: 22%" />
            </colgroup>
            <thead class="table-title-row">
              <tr>
                <th class="th-name">
                  <span class="th-name-label">院友名字</span>
                </th>
                <th class="th-date">截至日期</th>
                <th class="th-type">結欠/結餘 (按一下切換)</th>
                <th class="th-actions"></th>
              </tr>
            </thead>
            <tbody id="dataBody" class="table-input-body">
              <tr class="data-row input-row" data-type="balance">
                <td class="td-name">
                  <div class="name-input-wrap">
                    <input type="text" class="name-input" placeholder="院友名字" list="namesDatalist" tabindex="0" autocomplete="off" />
                  </div>
                </td>
                <td class="td-date">
                  <input type="date" class="date-input" tabindex="-1" />
                </td>
                <td class="td-type-amount">
                  <button type="button" class="btn-type" data-type="balance" tabindex="-1">結餘</button>
                  <span class="amount-prefix">$</span>
                  <input type="number" class="amount-input" min="0" step="0.01" placeholder="0" tabindex="0" />
                </td>
                <td class="td-row-actions">
                  <button type="button" class="btn-add" tabindex="-1">加入</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <aside class="section-preview">
        <header class="preview-header">
          <h2 class="preview-title">預覽匯出</h2>
          <span class="preview-hint">即時顯示匯出內容</span>
          <button type="button" class="btn-export" id="btnExport">匯出至 NotePad</button>
        </header>
        <div id="previewOutput" class="preview-output"></div>
      </aside>
    </main>
  </div>

  <!-- 說明彈窗 -->
  <div class="modal-overlay help-modal-overlay" id="helpModal" aria-hidden="true">
    <div class="modal-box help-modal-box">
      <h2 class="modal-title">📖 使用說明</h2>
      <div class="help-content">
        <section>
          <h3>👋 歡迎使用院友零用金系統</h3>
          <p>這個網頁用來記錄院友的零用金結欠或結餘，並可匯出成文字檔，方便列印或傳送。以下一步一步教您如何使用。</p>
        </section>
        <section>
          <h3>📥 第一步：匯入院友名單（匯入）</h3>
          <p>在表格最上方「院友名字」右邊有一個藍色按鈕叫<strong>【匯入】</strong>。</p>
          <ul>
            <li>請先準備好一個文字檔，檔名為 <code>names.txt</code>，裡面每行寫一個院友名字。</li>
            <li>按一下【匯入】→ 會請您選擇檔案 → 選取 <code>names.txt</code>。</li>
            <li>成功後，之後在「院友名字」欄位輸入時，就會出現下拉選單，方便選名字，不用每次手打。✅</li>
          </ul>
        </section>
        <section>
          <h3>✏️ 第二步：填寫每一列資料</h3>
          <p>每一列代表一位院友的一筆記錄。請依序填寫：</p>
          <ul>
            <li><strong>院友名字</strong> 👤：點一下空格，可從下拉選單選名字，或直接打字。已選過的名字在別的列不會再出現，避免重複。</li>
            <li><strong>截至日期</strong> 📅：點日期欄位，選一個日期。新列的日期會預設與第一列相同，有需要可手動修改。</li>
            <li><strong>結欠 / 結餘</strong> 💰：按一下可切換「結餘」或「結欠」。</li>
            <li><strong>金額</strong> 💵：在 $ 後面輸入數字（例如 100）。</li>
          </ul>
        </section>
        <section>
          <h3>➕ 加入一筆記錄</h3>
          <p>最上面<strong>第一列是輸入列</strong>，只有<strong>【加入】</strong>按鈕。填好院友名字、日期、結欠/結餘、金額後：</p>
          <ul>
            <li>按<strong>【加入】</strong>按鈕，或</li>
            <li>在「金額」欄位按鍵盤<strong> Enter</strong>。</li>
          </ul>
          <p>該筆資料會加到<strong>下面一列</strong>，輸入列會清空，游標留在「院友名字」讓您繼續輸入。👍</p>
        </section>
        <section>
          <h3>🗑️ 刪除一列</h3>
          <p>已加入的列（下面有資料的列）右邊有<strong>【刪除】</strong>按鈕，按一下即可刪除該列。最上面第一列是輸入列，沒有刪除按鈕。</p>
        </section>
        <section>
          <h3>🔍 篩選：只看結欠或結餘</h3>
          <p>頁面頂部有「篩選」：</p>
          <ul>
            <li><strong>全部</strong>：顯示所有列。</li>
            <li><strong>結欠</strong>：只顯示結欠的記錄。</li>
            <li><strong>結餘</strong>：只顯示結餘的記錄。</li>
          </ul>
          <p>方便您快速查看某一類記錄。👀</p>
        </section>
        <section>
          <h3>⌨️ 鍵盤 Tab 鍵</h3>
          <p>在「院友名字」或「金額」欄位時，按<strong> Tab</strong> 鍵會在下一個「名字」或「金額」之間跳動，不會跳到日期或按鈕，方便連續輸入。↔️</p>
        </section>
        <section>
          <h3>📄 範本（可選）</h3>
          <p>按頂部的<strong>【範本】</strong>可開啟「匯出範本」視窗：</p>
          <ul>
            <li>匯出成文字檔時，會依照範本裡的格式來寫內容。</li>
            <li>您可修改範本文字；可用變數：<code>{name}</code>、<code>{date}</code>、<code>{typeLabel}</code>、<code>{dollarPart}</code>。</li>
            <li>下方有 1、2、3、4 和【+】，可儲存多個範本；<strong>藍色</strong>的那個就是匯出時會用的。</li>
            <li>按【儲存】會儲存目前範本；按【刪除】可刪除目前選中的範本（至少保留一個）。</li>
          </ul>
        </section>
        <section>
          <h3>📤 匯出至 NotePad（產生文字檔）</h3>
          <p>填好資料後，按右邊預覽區的<strong>【匯出至 NotePad】</strong>：</p>
          <ul>
            <li>系統會把<strong>所有有填名字和日期的列</strong>合併成一個文字檔。</li>
            <li>檔案會依「最新在上、較舊在下」排列。</li>
            <li>結欠的金額會顯示成「--$數字」。</li>
            <li>下載的檔案可直接用記事本（NotePad）或其他文字軟體開啟、列印或傳送。📩</li>
          </ul>
        </section>
        <section>
          <h3>💡 小提示</h3>
          <ul>
            <li>資料會依您選的「範本」格式匯出；記得在範本視窗裡選好要用的範本（藍色）。</li>
            <li>如有任何問題，可隨時再按【說明】重看這頁。祝您使用順利！🙏</li>
          </ul>
        </section>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-modal-cancel" id="btnHelpClose">關閉</button>
      </div>
    </div>
  </div>

  <!-- 私隱說明彈窗 -->
  <div class="modal-overlay privacy-modal-overlay" id="privacyModal" aria-hidden="true">
    <div class="modal-box help-modal-box privacy-modal-box">
      <h2 class="modal-title">🔒 私隱說明</h2>
      <div class="privacy-content">
        <p>我們重視您的私隱。本頁面以下列方式處理您的資料，請務必閱讀：</p>
        <div class="privacy-box privacy-box-local">
          <strong>📌 資料僅存於本分頁</strong><br>
          所有您輸入或產生的資料（例如院友名單、零用金記錄、日期與金額等）<strong>僅存放在您目前開啟的「這個瀏覽器分頁」的記憶體中</strong>。我們不會將這些資料寫入您電腦的硬碟或任何長期儲存位置，也不會傳送到任何伺服器。
        </div>
        <div class="privacy-box privacy-box-warning">
          <strong>⚠️ 關閉分頁 → 所有資料會消失</strong><br>
          當您<strong>關閉此分頁</strong>或關閉瀏覽器視窗時，該分頁的記憶體會被釋放，<strong>所有資料會立即消失，無法復原</strong>。請在關閉前先完成匯出或下載，並自行保存檔案。
        </div>
        <div class="privacy-box privacy-box-warning">
          <strong>⚠️ 重新整理頁面 → 所有資料也會消失</strong><br>
          當您按<strong>「重新整理」(F5)</strong>或重新載入本頁時，頁面會重新載入，<strong>暫存於分頁中的資料同樣會全部消失，無法復原</strong>。若需保留資料，請先匯出或下載後再進行重新整理。
        </div>
        <div class="privacy-box privacy-box-safe">
          <strong>✅ 我們不會上傳或儲存您的資料</strong><br>
          本網站<strong>不會</strong>將您的任何資料上傳、儲存或傳送至任何伺服器或第三方。一切資料僅存在於您裝置上該分頁的記憶體中，由您完全掌控。
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-modal-cancel" id="btnPrivacyClose">關閉</button>
      </div>
    </div>
  </div>

  <!-- 範本彈窗 -->
  <div class="modal-overlay" id="templateModal" aria-hidden="true">
    <div class="modal-box">
      <h2 class="modal-title">匯出範本</h2>
      <p class="modal-hint">可用變數：<code>{name}</code> 院友名字、<code>{date}</code> 截至日期、<code>{typeLabel}</code> 結欠/結餘、<code>{dollarPart}</code> 金額（如 $100 或 --$100）</p>
      <textarea id="templateTextarea" class="template-textarea" rows="12"></textarea>
      <div class="template-slots-row">
        <span class="template-slots-label">範本</span>
        <div class="template-slot-buttons" id="templateSlotButtons"></div>
        <button type="button" class="btn-slot-add" id="btnSlotAdd" title="新增範本">+</button>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-modal-save" id="btnTemplateSave">儲存</button>
        <button type="button" class="btn-modal-delete" id="btnTemplateDelete">刪除</button>
        <button type="button" class="btn-modal-cancel" id="btnTemplateCancel">取消</button>
      </div>
    </div>
  </div>

  <datalist id="namesDatalist"></datalist>
  <script src="money-app.js"></script>
</body>
</html>
